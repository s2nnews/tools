<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="css/style.css"/>
  <title>Signal2Noise</title>
  <link rel="icon" href="./img/favicon.png" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css"/>
  <link rel="stylesheet" href="./css/bootstrap.min.css"/>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-S75JW6CS2D"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-S75JW6CS2D');
  </script>

  <style>
    /* Override Bootstrap container constraints for our layout */
    .container {
      max-width: 100% !important;
      padding-right: 15px;
      padding-left: 15px;
      margin-right: auto;
      margin-left: auto;
    }
    
    #content {
      margin-top: 0;
      margin-left: auto;
      margin-right: auto;
      width: 100%;
      max-width: 1200px; 
      padding: 0; 
      box-sizing: border-box;
    }
    
    /* Make images responsive */
    #content img {
      max-width: 100%;
      height: auto;
      display: block;
      box-sizing: border-box;
    }
    
    /* Force all content elements to respect container width */
    #content * {
      max-width: 100%;
      box-sizing: border-box;
    }

    .active-button {
      background-color: white !important; /* Force white background */
      color: black !important;           /* Force black text */
      border: 1px solid #ccc !important; /* Keep or remove as desired */
    }

    /* Top navigation menu buttons - RED background */
    .secondary-navbar .category, 
    .secondary-navbar .withoutredbg {
      background-color: #d9302c; 
      color: white;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
      margin-right: 2px;
      border-radius: 0;
    }

    /* Second row - GREY buttons */
    .filters .filter, 
    .filters .withoutredbg {
      background-color: grey;
      color: white;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
      margin-right: 2px;
      border-radius: 0;
    }

    /* Hover effect for buttons */
    .filter:hover, .withoutredbg:hover, .category:hover {
      background-color: #555; 
      opacity: 0.9; 
    }

    /* Top menu hover effect */
    .secondary-navbar .category:hover,
    .secondary-navbar .withoutredbg:hover {
      background-color: #b82722; 
    }

    /* Default styles for submenus and main menu */
    .filters, .secondary-navbar {
      display: flex;
      flex-wrap: nowrap; 
    }

    .filters button, .secondary-navbar button {
      padding: 10px 15px;
      font-size: 1rem; 
      flex: 0 1 auto; 
    }
    
    @media (max-width: 1200px) {
      #content {
        margin-left: 10%; 
        width: 65%; 
      }
      .filters button, .secondary-navbar button {
        padding: 8px 12px; 
        font-size: 0.9rem; 
      }
    }

    @media (max-width: 992px) {
      #content {
        margin-left: 8%;
        width: 60%; 
      }
    }

    @media (max-width: 768px) {
      #content {
        margin-left: 5%; 
        width: 90%; 
      }
      .filters {
        display: flex;
        flex-wrap: wrap; 
        gap: 5px; 
      }
      .secondary-navbar {
        display: flex;
        flex-wrap: wrap; 
        gap: 5px; 
      }
      .filters button, .secondary-navbar button {
        padding: 6px 10px; 
        font-size: 0.8rem; 
        flex: 1 0 auto; 
        margin-bottom: 5px; 
      }
    }
    
    @media (min-width: 1400px) {
      #content {
        margin-left: 14%;
        width: 76%;
      }
    }
    
    @media (min-width: 1800px) {
      #content {
        max-width: none !important; 
        margin-left: 14%;
        width: 75%; 
      }
    }
    
    .filters {
      display: none; /* Hide all submenus by default */
      flex-wrap: wrap; 
      gap: 10px; 
      margin-top: 10px; 
    }

    .filters button {
      background-color: grey;
      color: white;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
      margin-right: 5px;
      border-radius: 0;
    }

    .filters button:hover {
      background-color: #555; 
    }

    .filters .active-button {
      background-color: white;
      color: black;
      border: 1px solid #ccc;
    }

    /* ------------------------------------------ */
    /* NEW: Allow tall images to scroll in popup  */
    .mfp-figure {
      max-height: 100vh;        /* never exceed viewport height */
      overflow-y: auto;         /* enable vertical scroll if tall */
    }
    /* ------------------------------------------ */

    /* Force Magnific Popup images to keep original height, 
       so if they're bigger than screen, we scroll instead of shrinking. */
    .mfp-img {
      max-height: none !important;
      max-width: none !important;
      width: auto !important;
      height: auto !important;
      display: block;      /* ensure no inline or floating */
      margin: 0 auto;      /* optional: center the image horizontally */
    }

    /* The container for the image + caption */
    .mfp-figure {
      max-height: 100vh !important;
      overflow-y: auto !important; /* enable vertical scrolling */
      overflow-x: hidden;          /* usually hide horizontal scroll */
      margin: 0; 
    }

    /* (Optional) if you see any extra spacing or margin issues,
       you can also reset figure > figcaption. */
    .mfp-figure figure {
      margin: 0;
      padding: 0;
    }

    /* Style for the S2N Home button */
    .top-nav-button {
      background-color: black;
      color: white;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
      font-size: 1rem;
      border-radius: 5px;
      margin-right: 10px; /* Add spacing between this button and the next item */
    }

    .top-nav-button:hover {
      background-color: #333; /* Darker grey on hover */
      color: white;
    }
  </style>
</head>
<body>
  <!-- TOP MENU -->
  <div class="container pt-4">
    <div class="menu-open"><span class="open"></span></div>
    <div class="ozmenu mt-4">
      <div class="menu-close"><span class="close"></span></div>
      <ul class="ozmenu-nav">
        <!-- S2N Home Button -->
        <li class="item">
          <button class="top-nav-button" onclick="window.location.href='https://signal2noise.news';">
            Newsletter
          </button>
        </li>
        <!-- Performance Dropdown -->
        <li class="item dropdownitem">
          <a class="nav-dropdown" href="#">Performance</a>
          <div class="dropdown">
            <ul>
              <li class="item">
                <a href="#" onclick="loadSection('overview.html', this)">Overview</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('best-to-worst-section.html', this)">Best to Worst</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('price-journey.html', this)">Price Journey</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('volatility-performance.html', this)">Rolling Volatility</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('correlation-performance.html', this)">Correlations</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('performance-stats.html', this)">Detailed Stats</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('drawdown.html', this)">Drawdown</a>
              </li>
            </ul>
          </div>
        </li>
        <!-- Chart Gallery Dropdown -->
        <li class="item dropdownitem">
          <a class="nav-dropdown" href="#">Chart Gallery</a>
          <div class="dropdown">
            <ul>
              <li class="item">
                <a href="#" onclick="loadSection('1yr-chart.html', this)">1yr Chart</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('5yr-chart.html', this)">5yr Chart</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('all-history-chart.html', this)">All History Chart</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('trending.html', this)">Trending</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('base-adj-chart.html', this)">Base Adj Chart</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('relative-performance.html', this)">Relative Performance</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('overbought-oversold.html', this)">Overbought / Oversold</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('sentiment.html', this)">Sentiment</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('seasonality_dayofyear_chart.html', this)">Seasonality</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('random-charts.html', this)">Random Charts</a>
              </li>
            </ul>
          </div>
        </li>
        <!-- Interest Rates Dropdown -->
        <li class="item dropdownitem">
          <a class="nav-dropdown" href="#">Interest Rates</a>
          <div class="dropdown">
            <ul>
              <li class="item">
                <a href="#" onclick="loadSection('yield-curves.html', this)">Global Yield Curves</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('current-rates.html', this)">Current Rates</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('yield-steepness.html', this)">Yield Steepness</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('10yr-yields.html', this)">10yr Global Bond Yields</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('10yr-global-spreads.html', this)">10yr Global Yield Spreads</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('corporate-yields.html', this)">Corporate Bond Yields</a>
              </li>
            </ul>
          </div>
        </li>
        <!-- Economics Dropdown -->
        <li class="item dropdownitem">
          <a class="nav-dropdown" href="#">Economics</a>
          <div class="dropdown">
            <ul>
              <li class="item">
                <a href="#" onclick="loadSection('economic-summary.html', this)">Economic Summary</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('gdp.html', this)">GDP</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('inflation.html', this)">Inflation</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('retail.html', this)">Retail</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('unemployment.html', this)">Unemployment</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('news.html', this)">News</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('economic-debt.html', this)">Debt</a>
              </li>
              <li class="item">
                <a href="#" onclick="loadSection('economic-indexes.html', this)">Economic Indexes</a>
              </li>
            </ul>
          </div>
        </li>
        <!-- Screeners Dropdown -->
        <li class="item dropdownitem">
          <a class="nav-dropdown" href="#">Screeners</a>
          <div class="dropdown">
            <ul>
              <li class="item">
                <a href="#" onclick="loadSection('screeners.html', this)">Screeners Overview</a>
              </li>
            </ul>
          </div>
        </li>
        <!-- Backtests Dropdown -->
        <li class="item dropdownitem">
          <a class="nav-dropdown" href="#">Backtests</a>
          <div class="dropdown">
            <ul>
              <li class="item">
                <a href="#" onclick="loadSection('backtests.html', this)">Backtests Overview</a>
              </li>
            </ul>
          </div>
        </li>
      </ul>
    </div>
  </div>

  <script src="ozmenu.js"></script>

  <!-- SECONDARY NAVBAR + SUBMENUS -->
  <div class="container">
    <nav class="secondary-navbar">
      <button class="category withoutredbg" onclick="loadSection('overview.html', this)">Performance</button>
      <button class="category" onclick="loadSection('1yr-chart.html', this)">Chart Gallery</button>
      <button class="category" onclick="loadSection('yield-curves.html', this)">Interest Rates</button>
      <button class="category" onclick="loadSection('economic-summary.html', this)">Economics</button>
      <button class="category" onclick="loadSection('screeners.html', this)">Screeners</button>
      <button class="category" onclick="loadSection('backtests.html', this)">Backtests</button>
    </nav>

    <!-- PERFORMANCE SUBMENU -->
    <div class="filters" id="performance-filters">
      <button class="withoutredbg" onclick="loadSection('overview.html', this)">Overview</button>
      <button class="filter" onclick="loadSection('best-to-worst-section.html', this)">Best to Worst</button>
      <button class="filter" onclick="loadSection('price-journey.html', this)">Price Journey</button>
      <button class="filter" onclick="loadSection('volatility-performance.html', this)">Rolling Volatility</button>
      <button class="filter" onclick="loadSection('correlation-performance.html', this)">Correlations</button>
      <button class="filter" onclick="loadSection('performance-stats.html', this)">Detailed Stats</button>
      <button class="filter" onclick="loadSection('drawdowns.html', this)">Drawdowns</button>
    </div>

    <!-- CHART GALLERY SUBMENU -->
    <div class="filters" id="chart-gallery-filters" style="display: none;">
      <button class="withoutredbg" onclick="loadSection('1yr-chart.html', this)">1yr Chart</button>
      <button class="filter" onclick="loadSection('5yr-chart.html', this)">5yr Chart</button>
      <button class="filter" onclick="loadSection('all-history-chart.html', this)">All History Chart</button>
      <button class="filter" onclick="loadSection('trending.html', this)">Trending</button>
      <button class="filter" onclick="loadSection('base-adj-chart.html', this)">Base Adj Chart</button>
      <button class="filter" onclick="loadSection('relative-performance.html', this)">Relative Performance</button>
      <button class="filter" onclick="loadSection('overbought-oversold.html', this)">Overbought / Oversold</button>
      <button class="filter" onclick="loadSection('sentiment.html', this)">Sentiment</button>
      <button class="filter" onclick="loadSection('seasonality_dayofyear_chart.html', this)">Seasonality</button>
      <button class="filter" onclick="loadSection('random-charts.html', this)">Random Charts</button>
    </div>

    <!-- INTEREST RATE SUBMENU -->
    <div class="filters" id="interest-rates-filters" style="display: none;">
      <button class="withoutredbg" onclick="loadSection('yield-curves.html', this)">Global Yield Curves</button>
      <button class="filter" onclick="loadSection('current-rates.html', this)">Current Rates</button>
      <button class="filter" onclick="loadSection('yield-steepness.html', this)">Yield Steepness</button>
      <button class="filter" onclick="loadSection('10yr-yields.html', this)">10yr Global Bond Yields</button>
      <button class="filter" onclick="loadSection('10yr-global-spreads.html', this)">10yr Global Yield Spreads</button>
      <button class="filter" onclick="loadSection('corporate-yields.html', this)">Corporate Bond Yields</button>
    </div>

    <!-- ECONOMICS SUBMENU -->
    <div class="filters" id="economics-filters" style="display: none;">
      <button class="withoutredbg" onclick="loadSection('economic-summary.html', this)">Economic Summary</button>
      <button class="filter" onclick="loadSection('gdp.html', this)">GDP</button>
      <button class="filter" onclick="loadSection('inflation.html', this)">Inflation</button>
      <button class="filter" onclick="loadSection('retail.html', this)">Retail</button>
      <button class="filter" onclick="loadSection('unemployment.html', this)">Unemployment</button>
      <button class="filter" onclick="loadSection('news.html', this)">News</button>
      <button class="filter" onclick="loadSection('economic-debt.html', this)">Debt</button>
      <button class="filter" onclick="loadSection('economic-indexes.html', this)">Economic Indexes</button>
    </div>
  </div>

  <!-- MAIN CONTENT AREA -->
  <div class="container-fluid pt-4" id="content">
    <!-- Content will be dynamically loaded here -->
  </div>

  <div class="sidebar-image left-image">
    <a href="https://tradenation.com/signal2noise/?cxd=36699_413097" style="display:block; position:absolute; top:0; left:0; width:100%; height:100%; z-index:10;"></a>
  </div>
  <div class="sidebar-image right-image">
    <a href="https://tradenation.com/signal2noise/?cxd=36699_413097" style="display:block; position:absolute; top:0; left:0; width:100%; height:100%; z-index:10;"></a>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="./js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>
<script src="./js/custom.js"></script>
<script>
  // Set up direct click handlers for all main menu buttons
  $(document).ready(function() {
    // Performance button (1st button)
    $(".secondary-navbar button:nth-child(1)").click(function() {
      $(".secondary-navbar button").removeClass("withoutredbg");
      $(this).addClass("withoutredbg");
      showSubMenu('performance-filters');
      const defaultButton = document.querySelector("#performance-filters button:nth-child(1)");
      $(".filters button").removeClass("withoutredbg");
      defaultButton.classList.add("withoutredbg");
      loadSection('overview.html', defaultButton);
    });

    // Chart Gallery button (2nd button)
    $(".secondary-navbar button:nth-child(2)").click(function() {
      $(".secondary-navbar button").removeClass("withoutredbg");
      $(this).addClass("withoutredbg");
      showSubMenu('chart-gallery-filters');
      const defaultButton = document.querySelector("#chart-gallery-filters button:nth-child(1)");
      $(".filters button").removeClass("withoutredbg");
      defaultButton.classList.add("withoutredbg");
      loadSection('1yr-chart.html', defaultButton);
    });

    // Interest Rates button (3rd button)
    $(".secondary-navbar button:nth-child(3)").click(function() {
      $(".secondary-navbar button").removeClass("withoutredbg");
      $(this).addClass("withoutredbg");
      showSubMenu('interest-rates-filters');
      const defaultButton = document.querySelector("#interest-rates-filters button:nth-child(1)");
      $(".filters button").removeClass("withoutredbg");
      defaultButton.classList.add("withoutredbg");
      loadSection('yield-curves.html', defaultButton);
    });

    // Economics button (4th button)
    $(".secondary-navbar button:nth-child(4)").click(function() {
      $(".secondary-navbar button").removeClass("withoutredbg");
      $(this).addClass("withoutredbg");
      showSubMenu('economics-filters');
      const defaultButton = document.querySelector("#economics-filters button:nth-child(1)");
      $(".filters button").removeClass("withoutredbg");
      defaultButton.classList.add("withoutredbg");
      loadSection('economic-summary.html', defaultButton);
    });

    // Screeners button (5th button)
    $(".secondary-navbar button:nth-child(5)").click(function() {
      $(".secondary-navbar button").removeClass("withoutredbg");
      $(this).addClass("withoutredbg");
      hideAllSubMenus();
      loadSection('screeners.html', this);
    });

    // Backtests button (6th button)
    $(".secondary-navbar button:nth-child(6)").click(function() {
      $(".secondary-navbar button").removeClass("withoutredbg");
      $(this).addClass("withoutredbg");
      hideAllSubMenus();
      loadSection('backtests.html', this);
    });

    // Initialize on document ready
    // Set Performance as active by default
    $(".secondary-navbar button:nth-child(1)").addClass("withoutredbg");
    showSubMenu('performance-filters');
    const defaultPerformanceButton = document.querySelector("#performance-filters button:nth-child(1)");
    defaultPerformanceButton.classList.add("withoutredbg");
    loadSection('overview.html', defaultPerformanceButton);
  });

  // Update the loadSection function to handle button states correctly
  function loadSection(file, button) {
    // Append a timestamp to the file URL to bypass cache
    const cacheBypassUrl = `${file}?t=${new Date().getTime()}`;

    // Load the HTML into #content
    fetch(cacheBypassUrl)
      .then(response => response.text())
      .then(html => {
        document.getElementById("content").innerHTML = html;
        initializeLightbox();
      })
      .catch(err => console.error('Error loading section:', err));

    // Identify which main menu section this button belongs to
    let mainMenuSection = '';
    if (file.includes('overview') || file.includes('best-to-worst') || file.includes('price-journey') || 
        file.includes('volatility-performance') || file.includes('correlation-performance') || 
        file.includes('performance-stats') || file.includes('drawdowns')) {
      mainMenuSection = 'performance';
    } else if (file.includes('chart') || file.includes('base-adj-chart') || file.includes('relative-performance') || 
               file.includes('trending') || file.includes('overbought-oversold') || file.includes('sentiment') || 
               file.includes('seasonality') || file.includes('random-charts')) {
      mainMenuSection = 'chart-gallery';
    } else if (file.includes('interest-rates') || file.includes('yield-curves') || 
               file.includes('current-rates') || file.includes('yield-steepness') || 
               file.includes('10yr-yields') || file.includes('10yr-global-spreads') || 
               file.includes('corporate-yields')) {
      mainMenuSection = 'interest-rates';
    } else if (file.includes('economic-') || file.includes('inflation') || file.includes('gdp') || 
               file.includes('unemployment') || file.includes('economic-debt') || file.includes('indexes') ||
               file.includes('retail') || file.includes('news')) {
      mainMenuSection = 'economics';
    } else if (file.includes('screeners')) {
      mainMenuSection = 'screeners';
    } else if (file.includes('backtests')) {
      mainMenuSection = 'backtests';
    }

    // Clear all active buttons from main menu
    const mainMenuButtons = document.querySelectorAll(".secondary-navbar button");
    mainMenuButtons.forEach(btn => btn.classList.remove("withoutredbg"));

    // Set the corresponding main menu button to active
    if (mainMenuSection === 'performance') {
      document.querySelector(".secondary-navbar button:nth-child(1)").classList.add("withoutredbg");
    } else if (mainMenuSection === 'chart-gallery') {
      document.querySelector(".secondary-navbar button:nth-child(2)").classList.add("withoutredbg");
    } else if (mainMenuSection === 'interest-rates') {
      document.querySelector(".secondary-navbar button:nth-child(3)").classList.add("withoutredbg");
    } else if (mainMenuSection === 'economics') {
      document.querySelector(".secondary-navbar button:nth-child(4)").classList.add("withoutredbg");
    } else if (mainMenuSection === 'screeners') {
      document.querySelector(".secondary-navbar button:nth-child(5)").classList.add("withoutredbg");
    } else if (mainMenuSection === 'backtests') {
      document.querySelector(".secondary-navbar button:nth-child(6)").classList.add("withoutredbg");
    }

    // Hide all submenus first
    hideAllSubMenus();

    // Show the appropriate submenu based on main menu section
    if (mainMenuSection === 'performance') {
      showSubMenu('performance-filters');
    } else if (mainMenuSection === 'chart-gallery') {
      showSubMenu('chart-gallery-filters');
    } else if (mainMenuSection === 'interest-rates') {
      showSubMenu('interest-rates-filters');
    } else if (mainMenuSection === 'economics') {
      showSubMenu('economics-filters');
    }

    // Clear active state from all buttons in the current submenu
    if (mainMenuSection) {
      const submenuId = `${mainMenuSection}-filters`;
      const submenu = document.getElementById(submenuId);
      if (submenu) {
        const submenuButtons = submenu.querySelectorAll("button");
        submenuButtons.forEach(btn => btn.classList.remove("withoutredbg"));
      }
    }

    // Set active class on the clicked button if it's in a submenu
    const parentSubmenu = button.closest('.filters');
    if (parentSubmenu) {
      button.classList.add("withoutredbg");
    }
  }

  function showSubMenu(submenuId) {
    // Hide all submenus first
    hideAllSubMenus();
    
    // Show the requested submenu
    const submenu = document.getElementById(submenuId);
    if (submenu) {
      submenu.style.display = 'flex';
    }
  }

  function hideAllSubMenus() {
    const allSubmenus = document.querySelectorAll('.filters');
    allSubmenus.forEach(menu => menu.style.display = 'none');
  }

  // New function to initialize lightbox for images
  function initializeLightbox() {
    // First, ensure all images in the content have lightbox capability
    prepareImagesForLightbox();

    // Initialize Magnific Popup for all images in the loaded content
    $('#content a.lightbox').magnificPopup({
      type: 'image',
      gallery: {
        enabled: true,
        navigateByImgClick: true,
        preload: [0, 1]
      },
      image: {
        verticalFit: false,
        titleSrc: 'title'
      },
      callbacks: {
        open: function() {
          // Force the image to maintain its aspect ratio
          $('.mfp-img').css({
            'max-width': '100%',
            'max-height': '100vh',
            'width': 'auto',
            'height': 'auto'
          });
        }
      }
    });
  }

  // Function to prepare images for lightbox
  function prepareImagesForLightbox() {
    // Find all images that aren't already in a lightbox
    const images = document.querySelectorAll('#content img:not(.mfp-img):not([data-lightbox-prepared])');

    images.forEach(img => {
      // Skip images inside a link that already has the lightbox class
      if (img.parentElement.tagName === 'A' &&
        (img.parentElement.classList.contains('lightbox') ||
          img.parentElement.closest('.image-gallery'))) {
        return;
      }

      // If image is not already inside a link, wrap it in one
      if (img.parentElement.tagName !== 'A') {
        const imgSrc = img.getAttribute('src');
        const wrapper = document.createElement('a');
        wrapper.href = imgSrc;
        wrapper.classList.add('lightbox');
        img.parentNode.insertBefore(wrapper, img);
        wrapper.appendChild(img);
      }
      // If image is inside a link but not set up for lightbox, add the class
      else if (img.parentElement.tagName === 'A') {
        img.parentElement.classList.add('lightbox');
      }

      // Mark this image as prepared
      img.setAttribute('data-lightbox-prepared', 'true');
    });
  }

  /* ---------------------------------------------
   * Lightbox/Gallery for any images 
   * within a container that has "image-gallery" 
   * or "lightbox" class
   * --------------------------------------------- */
  $(document).ready(function () {
    // Example 1: .image-gallery container, open all child links
    $('.image-gallery').magnificPopup({
      delegate: 'a',  // child <a> elements
      type: 'image',
      gallery: {
        enabled: true,
        navigateByImgClick: true,
        preload: [0,1],
      },
      image: {
        verticalFit: false // let tall images scroll
      }
    });

    // Example 2: any anchor with .lightbox class
    $('.lightbox').magnificPopup({
      type: 'image',
      gallery: {
        enabled: true,
        navigateByImgClick: true,
        preload: [0,1],
      },
      image: {
        verticalFit: false // let tall images scroll
      }
    });
  });
  
</script>
</body>
</html>